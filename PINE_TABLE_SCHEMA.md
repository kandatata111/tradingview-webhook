# ダウ雲Pine表 完全再現スキーマ

## 📋 必要なデータ構造

```json
{
  "symbol": "USDJPY",
  "tf": "5m",
  "time": "2025-10-18 21:20:00",
  "price": 149.856,
  
  // デイル/スイングダウ情報
  "daily_dow": {
    "status": "ダウ",
    "bos": "BOS-3",
    "time": "00/10:05"
  },
  "swing_dow": {
    "status": "ダウ+",
    "bos": "BOS+1",
    "time": "00/08:40"
  },
  
  // 雲の並び順（価格基準で近い順）
  "cloud_order": ["4H", "5m", "15m", "1H"],
  
  // 各雲の詳細データ
  "clouds": [
    {
      "label": "5m",
      "tf": "5m",
      "gc": true,                    // GC/DC
      "fire_count": 8,               // 発火数（負の値はDC）
      "max_reached": false,
      "thickness": 3.1,              // 雲厚み (Pips)
      "angle": 31.9,                 // 雲角度
      "elapsed": "00/04:45",         // 経過時間（日/時:分）
      "distance_from_price": 8.6,    // 価格からの距離 (Pips)
      "distance_from_prev": null     // 前の雲からの距離 (最初はnull)
    },
    {
      "label": "15m",
      "tf": "15m",
      "gc": true,
      "fire_count": 6,
      "max_reached": false,
      "thickness": 5.2,
      "angle": 30.2,
      "elapsed": "00/09:45",
      "distance_from_price": 6.3,
      "distance_from_prev": 15.0     // 5m雲からの距離
    },
    {
      "label": "1H",
      "tf": "1H",
      "gc": true,
      "fire_count": 1,
      "max_reached": false,
      "thickness": 27.7,
      "angle": 29.6,
      "elapsed": "00/03:10",
      "distance_from_price": 1.0,
      "distance_from_prev": 14.6
    },
    {
      "label": "4H",
      "tf": "4H",
      "gc": false,
      "fire_count": 0,
      "max_reached": false,
      "thickness": 35.5,
      "angle": -2.8,
      "elapsed": "03/01:45",
      "distance_from_price": -29.6,  // 負は価格の下
      "distance_from_prev": -2.8
    }
  ]
}
```

## 🎨 表示レイアウト

```
┌──────────────────────────────────────┐
│ USDJPY - 149.856 (5m)               │
├────────┬──────┬──────┬────────────┤
│ デイル   │ ダウ  │ BOS-3│ 00/10:05  │
│ スイング │ ダウ+ │ BOS+1│ 00/08:40  │
├────────┴──────┴──────┴────────────┤
│ 雲整列 │雲方向│発火数│各雲間│価格間│雲角度│雲厚み│経過時間│
├──────┼────┼────┼────┼────┼────┼────┼──────┤
│ 価格   │      │      │      │      │      │      │        │
├──────┼────┼────┼────┼────┼────┼────┼──────┤
│ 4H    │▼DC  │  0   │-2.8  │-29.6│-2.8° │ 35.5 │03/01:45│
├──────┼────┼────┼────┼────┼────┼────┼──────┤
│ 5m    │▲GC  │  8   │ 8.6  │ 8.6 │31.9° │ 3.1  │00/04:45│
├──────┼────┼────┼────┼────┼────┼────┼──────┤
│ 15m   │▲GC  │  6   │ 15.0 │ 6.3 │30.2° │ 5.2  │00/09:45│
├──────┼────┼────┼────┼────┼────┼────┼──────┤
│ 1H    │▲GC  │  1   │ 14.6 │ 1.0 │29.6° │ 27.7 │00/03:10│
└──────┴────┴────┴────┴────┴────┴────┴──────┘
```

## 🔧 実装ステップ

### 1. Pine Script側の修正
- `daily_dow`と`swing_dow`の情報を追加
- `cloud_order`を計算（価格からの距離でソート）
- `distance_from_price`を計算
- `distance_from_prev`を計算
- `elapsed`を"日日/時時:分分"形式で送信

### 2. render_server.py の修正
- データベーススキーマを拡張
- デイル/スイングダウ情報を保存
- 雲の順序情報を保存

### 3. dashboard.html の修正
- 縦型テーブルレイアウトに変更
- デイル/スイングダウヘッダーを追加
- 雲整列順に表示
- 各カラムを表の通りに配置
