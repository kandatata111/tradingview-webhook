<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ€ã‚¦é›²Pineè¡¨ å®Œå…¨å†ç¾</title>
    <style>
        :root {
            --gc-bg-color: #22c55e;
            --dc-bg-color: #ef4444;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Consolas', 'Courier New', monospace;
            min-height: 100vh;
            padding: 15px;
            transition: background-color 0.3s, color 0.3s;
        }
        
        /* ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ */
        body.theme-dark {
            background: #0a0e27;
            color: #e0e0e0;
        }
        
        /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ */
        body.theme-light {
            background: #f5f7fa;
            color: #2d3748;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 24px;
            color: white;
            font-weight: 700;
        }
        
        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            color: white;
            font-size: 13px;
        }
        
        .icon-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            color: white;
            font-size: 18px;
            transition: background 0.3s;
        }
        
        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        select, button {
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            font-size: 12px;
            cursor: pointer;
            font-family: inherit;
        }
        
        select {
            background: white;
            color: #333;
        }
        
        button {
            background: #22c55e;
            color: white;
            font-weight: 600;
        }
        
        button:hover {
            background: #16a34a;
        }
        
        .tables-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(850px, 1fr));
            gap: 20px;
        }
        
        .pine-table-wrapper {
            background: #16213e;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            overflow-x: auto;
            transition: background-color 0.3s;
        }
        
        body.theme-light .pine-table-wrapper {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .pine-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            background: #1a1f3a;
            transition: background-color 0.3s;
        }
        
        body.theme-light .pine-table {
            background: #fafafa;
        }
        
        .pine-table th,
        .pine-table td {
            border: 1px solid #2a3f5f;
            padding: 8px 10px;
            text-align: center;
            font-size: inherit; /* è¦ªè¦ç´ ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’ç¶™æ‰¿ */
            font-weight: 700 !important; /* å…¨ã¦ã®æ–‡å­—ã‚’å¤ªå­—ã«çµ±ä¸€ */
        }
        
        body.theme-light .pine-table th,
        body.theme-light .pine-table td {
            border: 1px solid #e2e8f0;
        }
        
        .pine-table th {
            background: #0f1729;
            color: #a0aec0;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        body.theme-light .pine-table th {
            background: #edf2f7;
            color: #4a5568;
        }
        
        /* åˆ—ã®è¡¨ç¤º/éè¡¨ç¤º */
        .pine-table th.hidden-col,
        .pine-table td.hidden-col {
            display: none;
        }
        
        .table-header {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            font-size: 15px;
            font-weight: 700;
            text-align: left;
            padding: 12px 15px !important;
        }
        
        .dow-section {
            font-weight: 600;
        }
        
        /* ãƒ€ã‚¦è¡Œã®GCèƒŒæ™¯è‰²ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼‰ */
        .dow-row.gc,
        .dow-row.gc td {
            background: #0d3d2d !important;
            color: #ffffff !important;
        }
        
        /* ãƒ€ã‚¦è¡Œã®DCèƒŒæ™¯è‰²ï¼ˆãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼‰ */
        .dow-row.dc,
        .dow-row.dc td {
            background: #3d0d1d !important;
            color: #ffffff !important;
        }
        
        /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ */
        body.theme-light .dow-row.gc,
        body.theme-light .dow-row.gc td {
            background: #d1fae5 !important;
            color: #ffffff !important;
        }
        
        body.theme-light .dow-row.dc,
        body.theme-light .dow-row.dc td {
            background: #fee2e2 !important;
            color: #ffffff !important;
        }
        
        .dow-label {
            text-align: left !important;
            font-size: 15px;
        }
        
        .dow-status {
            font-weight: 700;
        }
        
        .price-row {
            background: #1e3a5f !important;
            font-weight: 700;
            font-size: 15px;
        }
        
        body.theme-light .price-row {
            background: #dbeafe !important;
        }
        
        .cloud-row.gc {
            background: #0d3d2d;
        }
        
        body.theme-light .cloud-row.gc {
            background: #d1fae5;
        }
        
        .cloud-row.dc {
            background: #3d0d1d;
        }
        
        body.theme-light .cloud-row.dc {
            background: #fee2e2;
        }
        
        .cloud-label {
            font-weight: 700;
            font-size: 15px;
            text-align: left !important;
            padding-left: 15px !important;
        }
        
        /* å€‹åˆ¥ã®é›²ãƒ©ãƒ™ãƒ«èƒŒæ™¯è‰²ã¨æ–‡å­—è‰² */
        .cloud-label[data-cloud-label="5m"] {
            background-color: #AFE899 !important;
            color: #000000 !important;
        }
        
        .cloud-label[data-cloud-label="15m"] {
            background-color: #FBCCA2 !important;
            color: #000000 !important;
        }
        
        .cloud-label[data-cloud-label="1H"] {
            background-color: #9BD0FD !important;
            color: #000000 !important;
        }
        
        .cloud-label[data-cloud-label="4H"] {
            background-color: #F99BFE !important;
            color: #000000 !important;
        }
        
        .direction-gc {
            color: #22c55e;
            font-weight: 700;
        }
        
        .direction-dc {
            color: #ef4444;
            font-weight: 700;
        }
        
        .fire-positive {
            color: #fbbf24;
            font-weight: 700;
        }
        
        .fire-negative {
            color: #f87171;
            font-weight: 700;
        }
        
        .distance-positive {
            color: #60a5fa;
        }
        
        .distance-negative {
            color: #fb923c;
        }
        
        .angle-positive {
            color: #34d399;
        }
        
        .angle-negative {
            color: #f87171;
        }
        
        .empty-cell {
            color: #4b5563;
        }
        
        .no-data {
            text-align: center;
            padding: 60px;
            color: #64748b;
            font-size: 16px;
        }
        
        .history-section {
            margin-top: 20px;
            background: #16213e;
            border-radius: 8px;
            padding: 15px;
        }
        
        body.theme-light .history-section {
            background: white;
        }
        
        .history-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #e0e0e0;
        }
        
        body.theme-light .history-title {
            color: #2d3748;
        }
        
        .history-item {
            background: #1a1f3a;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            border-left: 3px solid #f59e0b;
        }
        
        body.theme-light .history-item {
            background: #f7fafc;
        }
        
        .history-time {
            color: #94a3b8;
        }
        
        /* è¨­å®šãƒ‘ãƒãƒ« */
        .settings-panel {
            position: fixed;
            right: -400px;
            top: 0;
            width: 380px;
            height: 100vh;
            background: #1a1f3a;
            box-shadow: -4px 0 12px rgba(0,0,0,0.3);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        
        body.theme-light .settings-panel {
            background: white;
            box-shadow: -4px 0 12px rgba(0,0,0,0.1);
        }
        
        .settings-panel.open {
            right: 0;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #2a3f5f;
        }
        
        body.theme-light .settings-header {
            border-bottom: 2px solid #e2e8f0;
        }
        
        .settings-title {
            font-size: 18px;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: #e0e0e0;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
        }
        
        body.theme-light .close-btn {
            color: #2d3748;
        }
        
        .setting-section {
            margin-bottom: 25px;
        }
        
        .setting-section-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #94a3b8;
            text-transform: uppercase;
        }
        
        body.theme-light .setting-section-title {
            color: #64748b;
        }
        
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .checkbox-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        body.theme-light .checkbox-item:hover {
            background: rgba(0,0,0,0.03);
        }
        
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .checkbox-item label {
            cursor: pointer;
            font-size: 13px;
            flex: 1;
        }
        
        .theme-selector {
            display: flex;
            gap: 10px;
        }
        
        .theme-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #2a3f5f;
            background: transparent;
            color: #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        body.theme-light .theme-btn {
            border-color: #e2e8f0;
            color: #2d3748;
        }
        
        .theme-btn.active {
            background: #667eea;
            border-color: #667eea;
            color: white;
        }
        
        .settings-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        .btn-reset,
        .btn-save {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-reset {
            background: #6b7280;
            color: white;
        }
        
        .btn-reset:hover {
            background: #4b5563;
        }
        
        .btn-save {
            background: #22c55e;
            color: white;
        }
        
        .btn-save:hover {
            background: #16a34a;
        }
        
        /* é€šè²¨ãƒšã‚¢éè¡¨ç¤º */
        .pine-table-wrapper.hidden-symbol {
            display: none;
        }
        
        /* ãƒ•ã‚§ãƒ¼ã‚º2/3: è¿½åŠ ã‚¹ã‚¿ã‚¤ãƒ« */
        .slider-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .slider-group label {
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .slider-group input[type="range"] {
            width: 100%;
            cursor: pointer;
        }
        
        .color-picker-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .color-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .color-item label {
            font-size: 13px;
            font-weight: 600;
        }
        
        .color-item input[type="color"] {
            width: 80px;
            height: 35px;
            border: 2px solid #2a3f5f;
            border-radius: 4px;
            cursor: pointer;
        }
        
        body.theme-light .color-item input[type="color"] {
            border-color: #cbd5e1;
        }
        
        .threshold-inputs {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-top: 4px;
        }
        
        .threshold-inputs input[type="number"] {
            padding: 6px;
            border: 1px solid #2a3f5f;
            border-radius: 4px;
            background: #1a2332;
            color: #e0e0e0;
            font-size: 12px;
        }
        
        body.theme-light .threshold-inputs input[type="number"] {
            background: white;
            color: #2d3748;
            border-color: #cbd5e1;
        }
        
        .import-export-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .btn-export,
        .btn-import {
            padding: 10px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s;
        }
        
        .btn-export {
            background: #3b82f6;
            color: white;
        }
        
        .btn-export:hover {
            background: #2563eb;
        }
        
        .btn-import {
            background: #8b5cf6;
            color: white;
        }
        
        .btn-import:hover {
            background: #7c3aed;
        }
        
        /* è¡Œã®éè¡¨ç¤º */
        .dow-row.hidden-row,
        .cloud-row.hidden-row {
            display: none;
        }
        
        /* é›²ã®éè¡¨ç¤ºï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”¨ï¼‰ */
        .cloud-row.hidden-cloud {
            display: none;
        }
    </style>
</head>
<body class="theme-dark">
    <div class="container">
        <header>
            <h1>ğŸŒ¥ï¸ ãƒ€ã‚¦é›²Pineè¡¨ å®Œå…¨å†ç¾</h1>
            <div class="controls">
                <div class="status-dot"></div>
                <span>æœ€çµ‚æ›´æ–°: <span id="last-update">--:--:--</span></span>
                <select id="refresh-interval" onchange="changeRefreshInterval()">
                    <option value="5000">5ç§’</option>
                    <option value="10000">10ç§’</option>
                    <option value="15000">15ç§’</option>
                    <option value="30000">30ç§’</option>
                    <option value="60000" selected>1åˆ†</option>
                    <option value="0">æ‰‹å‹•ã®ã¿</option>
                </select>
                <button class="icon-btn" onclick="toggleTheme()" title="ãƒ†ãƒ¼ãƒåˆ‡æ›¿">ğŸŒ“</button>
                <button class="icon-btn" onclick="toggleSettings()" title="è¨­å®š">âš™ï¸</button>
                <button onclick="loadCurrentStates()">ğŸ”„ æ›´æ–°</button>
            </div>
        </header>
        
        <div id="tables-container" class="tables-container">
            <div class="no-data">ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
        
        <div class="history-section">
            <div class="history-title">ğŸ“Š æœ€è¿‘ã®ç™ºç«å±¥æ­´</div>
            <div id="fire-history"></div>
        </div>
    </div>
    
    <!-- è¨­å®šãƒ‘ãƒãƒ« -->
    <div id="settings-panel" class="settings-panel">
        <div class="settings-header">
            <div class="settings-title">âš™ï¸ è¡¨ç¤ºè¨­å®š</div>
            <button class="close-btn" onclick="toggleSettings()">âœ•</button>
        </div>
        
        <div class="setting-section">
            <div class="setting-section-title">ğŸ¨ ãƒ†ãƒ¼ãƒ</div>
            <div class="theme-selector">
                <button class="theme-btn active" data-theme="dark" onclick="setTheme('dark')">ğŸŒ™ ãƒ€ãƒ¼ã‚¯</button>
                <button class="theme-btn" data-theme="light" onclick="setTheme('light')">â˜€ï¸ ãƒ©ã‚¤ãƒˆ</button>
            </div>
        </div>
        
        <div class="setting-section">
            <div class="setting-section-title">ğŸ“Š åˆ—ã®è¡¨ç¤º</div>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="col-direction" checked onchange="updateColumnVisibility()">
                    <label for="col-direction">é›²æ–¹å‘</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-fire" checked onchange="updateColumnVisibility()">
                    <label for="col-fire">ç™ºç«æ•°</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-cloud-dist" checked onchange="updateColumnVisibility()">
                    <label for="col-cloud-dist">å„é›²é–“</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-price-dist" checked onchange="updateColumnVisibility()">
                    <label for="col-price-dist">ä¾¡æ ¼é–“</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-angle" checked onchange="updateColumnVisibility()">
                    <label for="col-angle">é›²è§’åº¦</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-thickness" checked onchange="updateColumnVisibility()">
                    <label for="col-thickness">é›²åšã¿</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="col-elapsed" checked onchange="updateColumnVisibility()">
                    <label for="col-elapsed">çµŒéæ™‚é–“</label>
                </div>
            </div>
        </div>
        
        <div class="setting-section">
            <div class="setting-section-title">ğŸ’± é€šè²¨ãƒšã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</div>
            <div id="symbol-filter" class="checkbox-group">
                <!-- å‹•çš„ã«ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- ãƒ•ã‚§ãƒ¼ã‚º2: è¡Œã®è¡¨ç¤º -->
        <div class="setting-section">
            <div class="setting-section-title">ï¿½ è¡Œã®è¡¨ç¤º</div>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="show-daily-dow" checked onchange="updateRowVisibility()">
                    <label for="show-daily-dow">ãƒ‡ã‚¤ãƒ€ã‚¦ã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="show-swing-dow" checked onchange="updateRowVisibility()">
                    <label for="show-swing-dow">ã‚¹ã‚¤ãƒ³ã‚°ãƒ€ã‚¦ã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="show-cloud-4h" checked onchange="updateRowVisibility()">
                    <label for="show-cloud-4h">4Hã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="show-cloud-1h" checked onchange="updateRowVisibility()">
                    <label for="show-cloud-1h">1Hã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="show-cloud-15m" checked onchange="updateRowVisibility()">
                    <label for="show-cloud-15m">15mã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="show-cloud-5m" checked onchange="updateRowVisibility()">
                    <label for="show-cloud-5m">5mã‚’è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-gc-only" onchange="updateDataFilter()">
                    <label for="filter-gc-only">GCã®ã¿è¡¨ç¤º</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="filter-dc-only" onchange="updateDataFilter()">
                    <label for="filter-dc-only">DCã®ã¿è¡¨ç¤º</label>
                </div>
            </div>
        </div>
        
        <!-- ãƒ•ã‚§ãƒ¼ã‚º2: è¡¨ç¤ºèª¿æ•´ -->
        <div class="setting-section">
            <div class="setting-section-title">ğŸ“ è¡¨ç¤ºèª¿æ•´</div>
            <div class="slider-group">
                <label for="font-size-slider">ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º: <span id="font-size-value">18px</span></label>
                <input type="range" id="font-size-slider" min="10" max="18" value="15" step="1" oninput="updateFontSize(this.value)">
            </div>
        </div>
        
        <!-- ãƒ•ã‚§ãƒ¼ã‚º3: è‰²è¨­å®š -->
        <div class="setting-section">
            <div class="setting-section-title">ğŸ¨ è‰²ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º</div>
            <div class="color-picker-group">
                <div class="color-item">
                    <label for="gc-bg-color">GCèƒŒæ™¯è‰²</label>
                    <input type="color" id="gc-bg-color" value="#22c55e" onchange="updateColors()">
                </div>
                <div class="color-item">
                    <label for="dc-bg-color">DCèƒŒæ™¯è‰²</label>
                    <input type="color" id="dc-bg-color" value="#ef4444" onchange="updateColors()">
                </div>
                <div class="color-item">
                    <label>åˆ—æ¯ã®æ–‡å­—è‰²è¨­å®š</label>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">é›²æ•´åˆ—:</span>
                        <input type="color" id="col-color-label" value="#000000" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">é›²æ–¹å‘:</span>
                        <input type="color" id="col-color-direction" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">ç™ºç«æ•°:</span>
                        <input type="color" id="col-color-fire" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">å„é›²é–“:</span>
                        <input type="color" id="col-color-cloud-dist" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">ä¾¡æ ¼é–“:</span>
                        <input type="color" id="col-color-price-dist" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">é›²è§’åº¦:</span>
                        <input type="color" id="col-color-angle" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">é›²åšã¿:</span>
                        <input type="color" id="col-color-thickness" value="#e0e0e0" onchange="updateColors()">
                    </div>
                    <div class="threshold-inputs">
                        <span style="width: 80px; display: inline-block;">çµŒéæ™‚é–“:</span>
                        <input type="color" id="col-color-elapsed" value="#e0e0e0" onchange="updateColors()">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ãƒ•ã‚§ãƒ¼ã‚º3: ã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ -->
        <div class="setting-section">
            <div class="setting-section-title">ğŸ’¾ è¨­å®šã®ä¿å­˜/èª­è¾¼</div>
            <div class="import-export-group">
                <button class="btn-export" onclick="exportSettings()">ğŸ“¤ è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                <button class="btn-import" onclick="document.getElementById('import-file').click()">ğŸ“¥ è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importSettings(event)">
            </div>
        </div>
        
        <div class="settings-actions">
            <button class="btn-reset" onclick="resetSettings()">ãƒªã‚»ãƒƒãƒˆ</button>
            <button class="btn-save" onclick="saveSettings()">ä¿å­˜ã—ã¦é–‰ã˜ã‚‹</button>
        </div>
    </div>
    
    <script>
        let refreshIntervalId = null;
        let currentInterval = 60000; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ1åˆ†
        let allSymbols = [];
        let settings = {
            theme: 'dark',
            columns: {
                direction: true,
                fire: true,
                cloudDist: true,
                priceDist: true,
                angle: true,
                thickness: true,
                elapsed: true
            },
            symbols: {},
            // ãƒ•ã‚§ãƒ¼ã‚º2: è¡Œã®è¡¨ç¤ºãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
            filters: {
                gcOnly: false,
                dcOnly: false,
                showDailyDow: true,
                showSwingDow: true,
                showCloud4H: true,
                showCloud1H: true,
                showCloud15m: true,
                showCloud5m: true
            },
            // ãƒ•ã‚§ãƒ¼ã‚º2: è¡¨ç¤ºèª¿æ•´
            display: {
                fontSize: 15
            },
            // ãƒ•ã‚§ãƒ¼ã‚º3: è‰²è¨­å®š
            colors: {
                gcBg: '#22c55e',
                dcBg: '#ef4444',
                // åˆ—æ¯ã®æ–‡å­—è‰²è¨­å®š
                colLabel: '#000000',      // é›²æ•´åˆ—åˆ—
                colDirection: '#e0e0e0',  // é›²æ–¹å‘åˆ—
                colFire: '#e0e0e0',       // ç™ºç«æ•°åˆ—
                colCloudDist: '#e0e0e0',  // å„é›²é–“åˆ—
                colPriceDist: '#e0e0e0',  // ä¾¡æ ¼é–“åˆ—
                colAngle: '#e0e0e0',      // é›²è§’åº¦åˆ—
                colThickness: '#e0e0e0',  // é›²åšã¿åˆ—
                colElapsed: '#e0e0e0'     // çµŒéæ™‚é–“åˆ—
            }
        };
        
        // è¨­å®šã‚’èª­ã¿è¾¼ã¿
        function loadSettings() {
            const saved = localStorage.getItem('pineTableSettings');
            if (saved) {
                settings = JSON.parse(saved);
                applySettings();
            }
        }
        
        // è¨­å®šã‚’é©ç”¨
        function applySettings() {
            // ãƒ†ãƒ¼ãƒé©ç”¨
            document.body.className = `theme-${settings.theme}`;
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === settings.theme);
            });
            
            // åˆ—è¡¨ç¤ºè¨­å®šã‚’é©ç”¨
            Object.keys(settings.columns).forEach(col => {
                const checkbox = document.getElementById(`col-${col.replace(/([A-Z])/g, '-$1').toLowerCase()}`);
                if (checkbox) {
                    checkbox.checked = settings.columns[col];
                }
            });
            
            // ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®šã‚’é©ç”¨
            if (settings.filters) {
                document.getElementById('filter-gc-only').checked = settings.filters.gcOnly || false;
                document.getElementById('filter-dc-only').checked = settings.filters.dcOnly || false;
                document.getElementById('show-daily-dow').checked = settings.filters.showDailyDow !== false;
                document.getElementById('show-swing-dow').checked = settings.filters.showSwingDow !== false;
                document.getElementById('show-cloud-4h').checked = settings.filters.showCloud4H !== false;
                document.getElementById('show-cloud-1h').checked = settings.filters.showCloud1H !== false;
                document.getElementById('show-cloud-15m').checked = settings.filters.showCloud15m !== false;
                document.getElementById('show-cloud-5m').checked = settings.filters.showCloud5m !== false;
            }
            
            // ãƒ•ã‚§ãƒ¼ã‚º2: è¡¨ç¤ºèª¿æ•´ã‚’é©ç”¨
            if (settings.display) {
                const fontSize = settings.display.fontSize || 18;
                document.getElementById('font-size-slider').value = fontSize;
                document.getElementById('font-size-value').textContent = fontSize + 'px';
                updateFontSize(fontSize);
            }
            
            // ãƒ•ã‚§ãƒ¼ã‚º3: è‰²è¨­å®šã‚’é©ç”¨
            if (settings.colors) {
                document.getElementById('gc-bg-color').value = settings.colors.gcBg || '#22c55e';
                document.getElementById('dc-bg-color').value = settings.colors.dcBg || '#ef4444';
                // åˆ—æ¯ã®æ–‡å­—è‰²è¨­å®š
                document.getElementById('col-color-label').value = settings.colors.colLabel || '#000000';
                document.getElementById('col-color-direction').value = settings.colors.colDirection || '#e0e0e0';
                document.getElementById('col-color-fire').value = settings.colors.colFire || '#e0e0e0';
                document.getElementById('col-color-cloud-dist').value = settings.colors.colCloudDist || '#e0e0e0';
                document.getElementById('col-color-price-dist').value = settings.colors.colPriceDist || '#e0e0e0';
                document.getElementById('col-color-angle').value = settings.colors.colAngle || '#e0e0e0';
                document.getElementById('col-color-thickness').value = settings.colors.colThickness || '#e0e0e0';
                document.getElementById('col-color-elapsed').value = settings.colors.colElapsed || '#e0e0e0';
                updateColors();
            }
            
            updateColumnVisibility();
            updateSymbolVisibility();
            updateRowVisibility();
            updateDataFilter();
        }
        
        // è¨­å®šã‚’ä¿å­˜
        function saveSettings() {
            // åˆ—è¨­å®šã‚’å–å¾—
            settings.columns = {
                direction: document.getElementById('col-direction').checked,
                fire: document.getElementById('col-fire').checked,
                cloudDist: document.getElementById('col-cloud-dist').checked,
                priceDist: document.getElementById('col-price-dist').checked,
                angle: document.getElementById('col-angle').checked,
                thickness: document.getElementById('col-thickness').checked,
                elapsed: document.getElementById('col-elapsed').checked
            };
            
            // é€šè²¨ãƒšã‚¢è¨­å®šã‚’å–å¾—
            document.querySelectorAll('#symbol-filter input[type="checkbox"]').forEach(cb => {
                settings.symbols[cb.dataset.symbol] = cb.checked;
            });
            
            // ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼è¨­å®šã‚’ä¿å­˜
            settings.filters = {
                gcOnly: document.getElementById('filter-gc-only').checked,
                dcOnly: document.getElementById('filter-dc-only').checked,
                showDailyDow: document.getElementById('show-daily-dow').checked,
                showSwingDow: document.getElementById('show-swing-dow').checked,
                showCloud4H: document.getElementById('show-cloud-4h').checked,
                showCloud1H: document.getElementById('show-cloud-1h').checked,
                showCloud15m: document.getElementById('show-cloud-15m').checked,
                showCloud5m: document.getElementById('show-cloud-5m').checked
            };
            
            // ãƒ•ã‚§ãƒ¼ã‚º2: è¡¨ç¤ºèª¿æ•´ã‚’ä¿å­˜
            settings.display = {
                fontSize: parseInt(document.getElementById('font-size-slider').value)
            };
            
            // ãƒ•ã‚§ãƒ¼ã‚º3: è‰²è¨­å®šã‚’ä¿å­˜
            settings.colors = {
                gcBg: document.getElementById('gc-bg-color').value,
                dcBg: document.getElementById('dc-bg-color').value,
                // åˆ—æ¯ã®æ–‡å­—è‰²è¨­å®š
                colLabel: document.getElementById('col-color-label').value,
                colDirection: document.getElementById('col-color-direction').value,
                colFire: document.getElementById('col-color-fire').value,
                colCloudDist: document.getElementById('col-color-cloud-dist').value,
                colPriceDist: document.getElementById('col-color-price-dist').value,
                colAngle: document.getElementById('col-color-angle').value,
                colThickness: document.getElementById('col-color-thickness').value,
                colElapsed: document.getElementById('col-color-elapsed').value
            };
            
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
            toggleSettings();
        }
        
        // è¨­å®šãƒªã‚»ãƒƒãƒˆ
        function resetSettings() {
            if (confirm('è¨­å®šã‚’åˆæœŸçŠ¶æ…‹ã«æˆ»ã—ã¾ã™ã‹?')) {
                localStorage.removeItem('pineTableSettings');
                location.reload();
            }
        }
        
        // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ
        function toggleTheme() {
            settings.theme = settings.theme === 'dark' ? 'light' : 'dark';
            applySettings();
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
        }
        
        function setTheme(theme) {
            settings.theme = theme;
            applySettings();
        }
        
        // è¨­å®šãƒ‘ãƒãƒ«é–‹é–‰
        function toggleSettings() {
            document.getElementById('settings-panel').classList.toggle('open');
        }
        
        // åˆ—ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ›´æ–°
        function updateColumnVisibility() {
            const colMap = {
                direction: 1,
                fire: 2,
                cloudDist: 3,
                priceDist: 4,
                angle: 5,
                thickness: 6,
                elapsed: 7
            };
            
            Object.keys(colMap).forEach(key => {
                const colIndex = colMap[key];
                const isVisible = document.getElementById(`col-${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`).checked;
                settings.columns[key] = isVisible;
                
                document.querySelectorAll(`.pine-table th:nth-child(${colIndex + 1}), .pine-table td:nth-child(${colIndex + 1})`).forEach(cell => {
                    cell.classList.toggle('hidden-col', !isVisible);
                });
            });
            
            // è¨­å®šã‚’å³åº§ã«ä¿å­˜
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
        }
        
        // é€šè²¨ãƒšã‚¢ã®è¡¨ç¤º/éè¡¨ç¤ºã‚’æ›´æ–°
        function updateSymbolVisibility() {
            // é€šè²¨ãƒšã‚¢è¨­å®šã‚’å³æ™‚æ›´æ–°
            document.querySelectorAll('#symbol-filter input[type="checkbox"]').forEach(cb => {
                settings.symbols[cb.dataset.symbol] = cb.checked;
            });
            
            document.querySelectorAll('.pine-table-wrapper').forEach(wrapper => {
                const symbol = wrapper.dataset.symbol;
                if (symbol && settings.symbols[symbol] !== undefined) {
                    wrapper.classList.toggle('hidden-symbol', !settings.symbols[symbol]);
                }
            });
            
            // è¨­å®šã‚’å³åº§ã«ä¿å­˜
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
        }
        
        // é€šè²¨ãƒšã‚¢ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”Ÿæˆ
        function generateSymbolFilter(symbols) {
            allSymbols = symbols;
            const container = document.getElementById('symbol-filter');
            container.innerHTML = symbols.map(symbol => {
                const checked = settings.symbols[symbol] !== false;
                return `
                    <div class="checkbox-item">
                        <input type="checkbox" id="sym-${symbol}" data-symbol="${symbol}" ${checked ? 'checked' : ''} onchange="updateSymbolVisibility()">
                        <label for="sym-${symbol}">${symbol}</label>
                    </div>
                `;
            }).join('');
            
            // è¨­å®šã‚’æ›´æ–°
            symbols.forEach(symbol => {
                if (settings.symbols[symbol] === undefined) {
                    settings.symbols[symbol] = true;
                }
            });
        }
        
        function formatTimeShort(timestamp) {
            const date = new Date(timestamp);
            return date.toLocaleTimeString('ja-JP');
        }
        
        async function loadCurrentStates() {
            console.log('loadCurrentStates called');
            try {
                const response = await fetch('/current_states');
                console.log('fetch response:', response);
                const data = await response.json();
                console.log('fetch data:', data);
                
                const container = document.getElementById('tables-container');
                
                if (data.status === 'success' && data.states.length > 0) {
                    // é€šè²¨ãƒšã‚¢ãƒªã‚¹ãƒˆã‚’æŠ½å‡ºã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ç”Ÿæˆ
                    const symbols = data.states.map(s => s.symbol);
                    if (symbols.length > allSymbols.length || !allSymbols.every(s => symbols.includes(s))) {
                        generateSymbolFilter(symbols);
                    }
                    
                    container.innerHTML = data.states.map(state => renderPineTable(state)).join('');
                    updateColumnVisibility();
                    updateSymbolVisibility();
                    updateRowVisibility();
                    updateDataFilter();
                } else {
                    container.innerHTML = '<div class="no-data">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                }
                
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString('ja-JP');
                
                // ç™ºç«å±¥æ­´ã‚‚æ›´æ–°
                loadFireHistory();
            } catch (error) {
                console.error('ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('tables-container').innerHTML = 
                    '<div class="no-data">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>';
            }
        }
        
        function getDowDirectionClass(statusText) {
            if (!statusText && statusText !== 0 && statusText !== 1 && statusText !== -1) return '';
            const text = statusText.toString();
            
            // å…¨è§’è‹±æ•°å­—ã‚’åŠè§’ã«æ­£è¦åŒ–
            const normalized = text
                .replace(/[ï¼¡-ï¼ºï½-ï½šï¼-ï¼™]/g, ch => String.fromCharCode(ch.charCodeAt(0) - 65248))
                .replace(/[ï¼‹]/g, '+')
                .replace(/[ï¼ãƒ¼âˆ’]/g, '-')
                .replace(/ï¼¤ï¼£/g, 'DC')
                .replace(/ï¼§ï¼£/g, 'GC');
            
            const upper = normalized.toUpperCase();
            
            // æ•°å€¤ãƒã‚§ãƒƒã‚¯: 1ã¯GCã€-1ã¯DCã€æ­£ã®æ•°ã¯GCã€è² ã®æ•°ã¯DC
            const numValue = parseFloat(text);
            if (!isNaN(numValue)) {
                if (numValue > 0) return 'gc';
                if (numValue < 0) return 'dc';
            }
            
            // DCï¼ˆä¸‹é™ãƒ»å£²ã‚Šï¼‰åˆ¤å®š
            if (
                upper.includes('DC') ||
                upper.includes('DOWN') ||
                upper.includes('BEAR') ||
                upper.includes('SELL') ||
                normalized.includes('â–¼') ||
                normalized.includes('ä¸‹é™') ||
                normalized.includes('ä¸‹è½') ||
                normalized.includes('ä¸‹ã’') ||
                normalized.includes('ä¸‹ã‚Š') ||
                normalized.includes('å£²') ||
                normalized.includes('ã‚·ãƒ§ãƒ¼ãƒˆ') ||
                normalized.includes('SHORT') ||
                upper.includes('BEARISH')
            ) {
                return 'dc';
            }
            
            // GCï¼ˆä¸Šæ˜‡ãƒ»è²·ã„ï¼‰åˆ¤å®š
            if (
                upper.includes('GC') ||
                upper.includes('UP') ||
                upper.includes('BULL') ||
                upper.includes('BUY') ||
                normalized.includes('â–²') ||
                normalized.includes('+') ||
                normalized.includes('ä¸Šæ˜‡') ||
                normalized.includes('ä¸Šã’') ||
                normalized.includes('ä¸Šã‚Š') ||
                normalized.includes('è²·') ||
                normalized.includes('ãƒ­ãƒ³ã‚°') ||
                normalized.includes('LONG') ||
                upper.includes('BULLISH')
            ) {
                return 'gc';
            }
            
            return '';
        }

        function renderPineTable(state) {
            const rowOrder = state.row_order || ['price', '5m', '15m', '1H', '4H'];
            const cloudOrder = state.cloud_order || ['5m', '15m', '1H', '4H'];
            const dailyDirectionClass = getDowDirectionClass(state.daily_dow.status) || getDowDirectionClass(state.daily_dow.bos);
            const swingDirectionClass = getDowDirectionClass(state.swing_dow.status) || getDowDirectionClass(state.swing_dow.bos);
            
            // ãƒ‡ãƒãƒƒã‚°æƒ…å ±ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›
            console.log('Daily Dow Status:', state.daily_dow.status, 'â†’ Class:', dailyDirectionClass);
            console.log('Swing Dow Status:', state.swing_dow.status, 'â†’ Class:', swingDirectionClass);

            // è¨­å®šã«åŸºã¥ã„ã¦è¡Œã®è¡¨ç¤º/éè¡¨ç¤ºã‚¯ãƒ©ã‚¹ã‚’æ±ºå®š
            const showDailyDow = settings.filters ? settings.filters.showDailyDow !== false : true;
            const showSwingDow = settings.filters ? settings.filters.showSwingDow !== false : true;
            const showCloud4H = settings.filters ? settings.filters.showCloud4H !== false : true;
            const showCloud1H = settings.filters ? settings.filters.showCloud1H !== false : true;
            const showCloud15m = settings.filters ? settings.filters.showCloud15m !== false : true;
            const showCloud5m = settings.filters ? settings.filters.showCloud5m !== false : true;

            return `
                <div class="pine-table-wrapper" data-symbol="${state.symbol}">
                    <table class="pine-table">
                        <tr>
                            <th colspan="8" class="table-header">
                                ${state.symbol} - ${state.price.toFixed(3)} (${state.tf}) 
                                <span style="font-size:11px; color:#94a3b8; margin-left:10px;">
                                    ${formatTimeShort(state.timestamp)}
                                </span>
                            </th>
                        </tr>
                        <tr class="dow-section dow-row ${dailyDirectionClass} ${showDailyDow ? '' : 'hidden-row'}">
                            <td class="dow-label">ãƒ‡ã‚¤</td>
                            <td class="dow-status" colspan="2">${state.daily_dow.status || '-'}</td>
                            <td>${state.daily_dow.bos || '-'}</td>
                            <td colspan="4">${state.daily_dow.time || '-'}</td>
                        </tr>
                        <tr class="dow-section dow-row ${swingDirectionClass} ${showSwingDow ? '' : 'hidden-row'}">
                            <td class="dow-label">ã‚¹ã‚¤ãƒ³ã‚°</td>
                            <td class="dow-status" colspan="2">${state.swing_dow.status || '-'}</td>
                            <td>${state.swing_dow.bos || '-'}</td>
                            <td colspan="4">${state.swing_dow.time || '-'}</td>
                        </tr>
                        <tr>
                            <th>é›²æ•´åˆ—</th>
                            <th>é›²æ–¹å‘</th>
                            <th>ç™ºç«æ•°</th>
                            <th>å„é›²é–“</th>
                            <th>ä¾¡æ ¼é–“</th>
                            <th>é›²è§’åº¦</th>
                            <th>é›²åšã¿</th>
                            <th>çµŒéæ™‚é–“</th>
                        </tr>
                        ${rowOrder.map(label => renderRow(label, state, {showCloud4H, showCloud1H, showCloud15m, showCloud5m})).join('')}
                    </table>
                </div>
            `;
        }
        
        function renderCloudRow(label, cloud, shouldHide = false) {
            if (!cloud) {
                return `
                    <tr class="cloud-row ${shouldHide ? 'hidden-row' : ''}">
                        <td class="cloud-label" data-cloud-label="${label}">${label}</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                    </tr>
                `;
            }
            
            const gcClass = cloud.gc ? 'gc' : 'dc';
            const directionClass = cloud.gc ? 'direction-gc' : 'direction-dc';
            const directionText = cloud.gc ? 'GC' : 'DC';
            const fireClass = cloud.fire_count > 0 ? 'fire-positive' : 'fire-negative';
            const angleClass = cloud.angle >= 0 ? 'angle-positive' : 'angle-negative';
            const distancePriceClass = cloud.distance_from_price >= 0 ? 'distance-positive' : 'distance-negative';
            const distancePrevClass = cloud.distance_from_prev >= 0 ? 'distance-positive' : 'distance-negative';
            
            return `
                <tr class="cloud-row ${gcClass} ${shouldHide ? 'hidden-row' : ''}" data-cloud-label="${label}">
                    <td class="cloud-label" data-cloud-label="${label}">${label}</td>
                    <td class="${directionClass}">${directionText}</td>
                    <td class="${fireClass}">${cloud.fire_count || 0}</td>
                    <td class="${distancePrevClass}">${cloud.distance_from_prev?.toFixed(2) || '-'}</td>
                    <td class="${distancePriceClass}">${cloud.distance_from_price?.toFixed(2) || '-'}</td>
                    <td class="${angleClass}">${cloud.angle?.toFixed(2) || '-'}Â°</td>
                    <td>${cloud.thickness?.toFixed(2) || '-'}</td>
                    <td>${cloud.elapsed || '-'}</td>
                </tr>
            `;
        }
        
        function renderRow(label, state, visibilitySettings = {}) {
            if (label === 'price') {
                return `
                    <tr class="price-row">
                        <td>ä¾¡æ ¼</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                        <td class="empty-cell">-</td>
                    </tr>
                `;
            } else {
                // é›²è¡Œã®è¡¨ç¤º/éè¡¨ç¤ºè¨­å®šã‚’ãƒã‚§ãƒƒã‚¯
                let shouldHide = false;
                if (label === '4H' && visibilitySettings.showCloud4H === false) {
                    shouldHide = true;
                } else if (label === '1H' && visibilitySettings.showCloud1H === false) {
                    shouldHide = true;
                } else if (label === '15m' && visibilitySettings.showCloud15m === false) {
                    shouldHide = true;
                } else if (label === '5m' && visibilitySettings.showCloud5m === false) {
                    shouldHide = true;
                }
                
                return renderCloudRow(label, state.clouds[label], shouldHide);
            }
        }
        
        async function loadFireHistory() {
            try {
                const response = await fetch('/fire_history');
                const data = await response.json();
                
                const historyDiv = document.getElementById('fire-history');
                
                if (data.status === 'success' && data.history.length > 0) {
                    historyDiv.innerHTML = data.history.slice(0, 10).map(h => `
                        <div class="history-item">
                            <div>
                                <strong>${h.symbol}</strong> - ${h.cloud_label} - ${h.message}
                            </div>
                            <div class="history-time">${formatTimeShort(h.timestamp)}</div>
                        </div>
                    `).join('');
                } else {
                    historyDiv.innerHTML = '<div style="color: #666; text-align: center;">ç™ºç«å±¥æ­´ãªã—</div>';
                }
            } catch (error) {
                console.error('å±¥æ­´å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
            }
        }
        
        function changeRefreshInterval() {
            const select = document.getElementById('refresh-interval');
            currentInterval = parseInt(select.value);
            
            if (refreshIntervalId) {
                clearInterval(refreshIntervalId);
                refreshIntervalId = null;
            }
            
            if (currentInterval > 0) {
                refreshIntervalId = setInterval(loadCurrentStates, currentInterval);
                console.log(`è‡ªå‹•æ›´æ–°: ${currentInterval / 1000}ç§’ã”ã¨`);
            } else {
                console.log('è‡ªå‹•æ›´æ–°: ç„¡åŠ¹');
            }
        }
        
        // ===== ãƒ•ã‚§ãƒ¼ã‚º2/3: æ–°æ©Ÿèƒ½é–¢æ•° =====
        
        // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´
        function updateFontSize(size) {
            document.getElementById('font-size-value').textContent = size + 'px';
            // ãƒ†ãƒ¼ãƒ–ãƒ«æœ¬ä½“ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’è¨­å®šï¼ˆth/tdã¯ç¶™æ‰¿ï¼‰
            document.querySelectorAll('.pine-table').forEach(table => {
                table.style.fontSize = size + 'px';
            });
            // å…¨ã¦ã®th/tdã«ã‚‚æ˜ç¤ºçš„ã«é©ç”¨ï¼ˆCSSç¶™æ‰¿ã‚’ç¢ºå®Ÿã«ï¼‰
            document.querySelectorAll('.pine-table th, .pine-table td').forEach(cell => {
                cell.style.fontSize = size + 'px';
            });
            // ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã‚’å³åº§ã«ä¿å­˜
            settings.display.fontSize = parseInt(size);
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
        }
        
        // è‰²è¨­å®šã‚’é©ç”¨
        function updateColors() {
            const gcBg = document.getElementById('gc-bg-color').value;
            const dcBg = document.getElementById('dc-bg-color').value;
            // åˆ—æ¯ã®æ–‡å­—è‰²
            const colLabel = document.getElementById('col-color-label').value;
            const colDirection = document.getElementById('col-color-direction').value;
            const colFire = document.getElementById('col-color-fire').value;
            const colCloudDist = document.getElementById('col-color-cloud-dist').value;
            const colPriceDist = document.getElementById('col-color-price-dist').value;
            const colAngle = document.getElementById('col-color-angle').value;
            const colThickness = document.getElementById('col-color-thickness').value;
            const colElapsed = document.getElementById('col-color-elapsed').value;
            
            // CSSå¤‰æ•°ã‚’æ›´æ–°
            const style = document.documentElement.style;
            style.setProperty('--gc-bg-color', gcBg);
            style.setProperty('--dc-bg-color', dcBg);
            
            // å‹•çš„ã«ã‚¹ã‚¿ã‚¤ãƒ«ãƒ«ãƒ¼ãƒ«ã‚’ä½œæˆï¼ˆè¡Œå…¨ä½“ã«è‰²ã‚’é©ç”¨ï¼‰
            let styleSheet = document.getElementById('dynamic-row-colors');
            if (!styleSheet) {
                styleSheet = document.createElement('style');
                styleSheet.id = 'dynamic-row-colors';
                document.head.appendChild(styleSheet);
            }
            
            styleSheet.textContent = `
                /* é›²è¡Œã¨ãƒ€ã‚¦è¡Œã®èƒŒæ™¯è‰² */
                .cloud-row.gc { background: ${gcBg} !important; }
                .cloud-row.dc { background: ${dcBg} !important; }
                .dow-row.gc, .dow-row.gc td { background: ${gcBg} !important; color: #ffffff !important; }
                .dow-row.dc, .dow-row.dc td { background: ${dcBg} !important; color: #ffffff !important; }
                
                /* ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰ã§ã‚‚ãƒ€ã‚¦è¡Œã®æ–‡å­—è‰²ã‚’ç™½ã« */
                body.theme-light .dow-row.gc, body.theme-light .dow-row.gc td { background: ${gcBg} !important; color: #ffffff !important; }
                body.theme-light .dow-row.dc, body.theme-light .dow-row.dc td { background: ${dcBg} !important; color: #ffffff !important; }
                
                /* é›²ãƒ©ãƒ™ãƒ«ã®èƒŒæ™¯è‰²ï¼ˆå€‹åˆ¥è¨­å®šã‚’ç¶­æŒï¼‰ */
                .cloud-label[data-cloud-label="4H"] { color: #000000 !important; }
                .cloud-label[data-cloud-label="1H"] { color: #000000 !important; }
                .cloud-label[data-cloud-label="15m"] { color: #000000 !important; }
                .cloud-label[data-cloud-label="5m"] { color: #000000 !important; }
                
                /* åˆ—æ¯ã®æ–‡å­—è‰²è¨­å®š */
                .pine-table .cloud-label { color: ${colLabel} !important; }
                .pine-table .direction-gc, .pine-table .direction-dc { color: ${colDirection} !important; }
                .pine-table .fire-positive, .pine-table .fire-negative { color: ${colFire} !important; }
                .pine-table td:nth-child(2) { color: ${colDirection} !important; }
                .pine-table td:nth-child(3) { color: ${colFire} !important; }
                .pine-table td:nth-child(4) { color: ${colCloudDist} !important; }
                .pine-table td:nth-child(5) { color: ${colPriceDist} !important; }
                .pine-table td:nth-child(6) { color: ${colAngle} !important; }
                .pine-table td:nth-child(7) { color: ${colThickness} !important; }
                .pine-table td:nth-child(8) { color: ${colElapsed} !important; }
            `;
            
            // è‰²è¨­å®šã‚’å³åº§ã«ä¿å­˜
            settings.colors = {
                gcBg: gcBg,
                dcBg: dcBg,
                colLabel: colLabel,
                colDirection: colDirection,
                colFire: colFire,
                colCloudDist: colCloudDist,
                colPriceDist: colPriceDist,
                colAngle: colAngle,
                colThickness: colThickness,
                colElapsed: colElapsed
            };
            localStorage.setItem('pineTableSettings', JSON.stringify(settings));
        }
        
        // ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
        function updateDataFilter() {
            const gcOnly = document.getElementById('filter-gc-only').checked;
            const dcOnly = document.getElementById('filter-dc-only').checked;
            
            document.querySelectorAll('.cloud-row').forEach(row => {
                let shouldHide = false;
                
                // GC/DCãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
                if (gcOnly && row.classList.contains('dc')) {
                    shouldHide = true;
                }
                if (dcOnly && row.classList.contains('gc')) {
                    shouldHide = true;
                }
                
                row.classList.toggle('hidden-cloud', shouldHide);
            });
        }
        
        // è¡Œã®è¡¨ç¤º/éè¡¨ç¤º
        function updateRowVisibility() {
            const showDailyDow = document.getElementById('show-daily-dow').checked;
            const showSwingDow = document.getElementById('show-swing-dow').checked;
            const showCloud4H = document.getElementById('show-cloud-4h').checked;
            const showCloud1H = document.getElementById('show-cloud-1h').checked;
            const showCloud15m = document.getElementById('show-cloud-15m').checked;
            const showCloud5m = document.getElementById('show-cloud-5m').checked;
            
            console.log('Row visibility settings:', {
                showDailyDow, showSwingDow, showCloud4H, showCloud1H, showCloud15m, showCloud5m
            });
            
            // ãƒ‡ã‚¤/ã‚¹ã‚¤ãƒ³ã‚°ãƒ€ã‚¦è¡Œ
            document.querySelectorAll('.dow-row').forEach(row => {
                const label = row.cells[0].textContent.trim();
                if (label === 'ãƒ‡ã‚¤') {
                    row.classList.toggle('hidden-row', !showDailyDow);
                    console.log('Daily Dow row visibility:', !showDailyDow);
                } else if (label === 'ã‚¹ã‚¤ãƒ³ã‚°') {
                    row.classList.toggle('hidden-row', !showSwingDow);
                    console.log('Swing Dow row visibility:', !showSwingDow);
                }
            });
            
            // é›²è¡Œ
            document.querySelectorAll('.cloud-row').forEach(row => {
                const label = row.getAttribute('data-cloud-label');
                let shouldHide = false;
                if (label === '4H') {
                    shouldHide = !showCloud4H;
                } else if (label === '1H') {
                    shouldHide = !showCloud1H;
                } else if (label === '15m') {
                    shouldHide = !showCloud15m;
                } else if (label === '5m') {
                    shouldHide = !showCloud5m;
                }
                row.classList.toggle('hidden-row', shouldHide);
                console.log(`Cloud row ${label} visibility:`, shouldHide);
            });
        }
        
        // è¨­å®šã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportSettings() {
            const dataStr = JSON.stringify(settings, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pine-table-settings-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            URL.revokeObjectURL(url);
            alert('è¨­å®šã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
        }
        
        // è¨­å®šã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        function importSettings(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    settings = imported;
                    localStorage.setItem('pineTableSettings', JSON.stringify(settings));
                    applySettings();
                    alert('è¨­å®šã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ');
                } catch (error) {
                    alert('è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
                }
            };
            reader.readAsText(file);
        }
        
        // åˆå›ãƒ­ãƒ¼ãƒ‰
        loadSettings();
        loadCurrentStates();
        refreshIntervalId = setInterval(loadCurrentStates, currentInterval);
    </script>
</body>
</html>
