@echo off
chcp 65001 > nul
echo ========================================
echo 🚀 ローカル開発環境起動 (最新データ同期)
echo ========================================

cd /d "%~dp0"

REM Pythonプロセスをクリーンアップ
echo 🧹 既存のPythonプロセスを停止中...
taskkill /F /IM python.exe 2>nul
timeout /t 1 /nobreak > nul

REM 開発サーバー起動
echo 🔧 開発サーバー起動中...
set PYTHONIOENCODING=utf-8
start "Dev Server" cmd /k "cd /d %~dp0 && python render_server.py"

echo ⏳ サーバー起動待機中...
timeout /t 5 /nobreak > nul

REM 本番サーバーから最新データを同期
echo.
echo � 本番サーバーから最新データを取得中...
python sync_production_data.py

echo.
echo ========================================
echo ✅ ローカル開発環境準備完了！
echo ========================================
echo.
echo 📊 ダッシュボード: http://localhost:5000/
echo 📡 本番サーバー: https://tradingview-webhook-s5x1.onrender.com/
echo.
echo 💡 使い方:
echo    1. ブラウザで http://localhost:5000/ を開く
echo    2. 最新のTradingViewデータが表示されます
echo    3. 再度最新データを取得: python sync_production_data.py
echo.
echo 終了するには Ctrl+C を押してください
echo ========================================

pause